# AgentWatch — Claude Code Project Reference

> **Purpose of this file**: Give Claude Code 100% complete context about this project without needing to read source files. Start here, then read ARCHITECTURE.md and CODEBASE.md for implementation details.

## What Is AgentWatch?

AgentWatch is a **real-time behavioral drift detection system for agentic AI applications**. It wraps existing LangChain or CrewAI agents and monitors them for three failure modes:

1. **Action Loops** — agent stuck repeating the same tool calls
2. **Goal Drift** — agent's output drifts semantically from its declared objective
3. **Resource Spikes** — token burn, duration, or tool call frequency exceeds normal

It runs entirely **in-process** (no server, no cloud, no dashboard) and stores data locally in SQLite. Alerts go out via Slack/Discord webhooks.

## Project Status

- **Version**: 0.1.0 (Alpha)
- **Package name**: `agentwatch`
- **Python**: 3.10+
- **State**: Functional prototype. Core detection logic works. Has known gaps (see WEAKNESSES.md).

## Quick Usage

```python
from agentwatch import DriftMonitor

monitor = DriftMonitor(
    agent_id="my-agent",
    alert_webhook="https://hooks.slack.com/...",
    goal_description="Summarize customer support tickets",
    calibration_runs=30,
)

# Wrap a LangChain agent
agent = monitor.wrap(existing_langchain_agent)
result = agent.invoke({"input": "process ticket #123"})

# Or record events manually (for non-LangChain agents)
run_id = monitor.start_run()
monitor.record_event(action_type="tool_call", action_name="search_db", run_id=run_id, token_count=150)
monitor.end_run(run_id)
```

## File Structure

```
agentwatch/
├── __init__.py          # Public exports: DriftMonitor, DriftCrew
├── models.py            # Data classes: TraceEvent, DriftEvent, BaselineStats, RunSummary
├── monitor.py           # DriftMonitor (main class) + _LangChainWrapper
├── crewai.py            # DriftCrew wrapper for CrewAI
├── cli.py               # Click CLI: alerts, traces, baseline, runs commands
├── detectors/
│   ├── base.py          # BaseDetector abstract class
│   ├── action_loop.py   # ActionLoopDetector
│   ├── goal_drift.py    # GoalDriftDetector (uses sentence-transformers)
│   └── resource_spike.py # ResourceSpikeDetector
├── storage/
│   └── __init__.py      # TraceStore (SQLite, thread-safe)
├── baseline/
│   └── __init__.py      # Calibrator (builds baseline stats from run history)
└── alerts/
    └── __init__.py      # AlertDispatcher (Slack/Discord/generic webhooks)

tests/
└── test_standalone.py   # Unit tests (stdlib + numpy only, no sentence-transformers)
```

## Key Design Decisions

- **No external infrastructure** — SQLite at `~/.agentwatch/agentwatch.db` by default
- **Lazy model loading** — sentence-transformers only loads when GoalDriftDetector is actually used
- **Transparent wrapping** — `_LangChainWrapper` proxies all unknown attributes to the real agent via `__getattr__`
- **Calibration-first** — statistical detectors don't fire until `calibration_runs` (default 30) runs are complete; absolute hard limits provide safety net immediately
- **All detectors are independent** — they run sequentially but don't share state; each returns a `DriftEvent | None`

## Dependencies

| Package | Purpose |
|---------|---------|
| `sentence-transformers>=2.2.0` | CPU embeddings for goal drift (model: `all-MiniLM-L6-v2`) |
| `scikit-learn>=1.3.0` | Statistical utilities |
| `numpy>=1.24.0` | Array math for baseline stats |
| `click>=8.1.0` | CLI framework |
| `httpx>=0.25.0` | Sync/async webhook HTTP |
| `rich>=13.0.0` | Styled terminal output |

Optional: `langchain`, `crewai` (for integrations)

## CLI Commands

```bash
agentwatch alerts --last 24h --agent my-agent --severity HIGH
agentwatch traces my-agent --run latest
agentwatch baseline my-agent
agentwatch runs my-agent --limit 10
```

## See Also

- `ARCHITECTURE.md` — full system architecture with data flows and component interactions
- `CODEBASE.md` — every class, method, and key implementation detail
- `WEAKNESSES.md` — known bugs, limitations, and improvement opportunities

## Git Policy

**Claude Code must never run `git`, `gh`, or any commands that result in commits/PRs.** All version control commands are written out for you to run manually. This keeps the contribution graph clean and all contributions credited to you.


<claude-mem-context>
# Recent Activity

<!-- This section is auto-generated by claude-mem. Edit content outside the tags. -->

*No recent activity*
</claude-mem-context>